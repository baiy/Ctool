import{u as v,i as b}from"./action-716087f2.js";import{c as k,a as T,T as s}from"./index-45e556eb.js";import{s as I}from"./index-636623a5.js";import{D as A,bj as C,l as w,bf as H,n as z,bk as a,aG as i,at as E,y as e,b0 as o}from"./history-00b3515f.js";import"./_commonjsHelpers-87174ba5.js";import"./index-b1ff2442.js";import"./shim-03580cdb.js";const D=A({__name:"Sign",async setup(U){let p,m;const t=v(([p,m]=C(()=>b({input:k("text"),option:{private_key:"",user_id:"1234567812345678"},output:T("hex")})),p=await p,m(),p)),c=w(()=>{if(t.current.input.text.isEmpty()||t.current.option.private_key==="")return s.empty();if(t.current.input.text.isError())return t.current.input.text;try{return s.fromHex(I.sm2.doSignature(t.current.input.text.toArray(),t.current.option.private_key,{hash:!0,userId:t.current.option.user_id}))}catch(r){return s.fromError($error(r))}});return H(()=>c.value,r=>{r.isEmpty()||t.save()},{immediate:!0,deep:!0}),(r,n)=>{const _=i("TextInput"),d=i("Input"),l=i("Align"),f=i("HelpTip"),x=i("Card"),g=i("TextOutput"),y=i("HeightResize");return E(),z(y,{ignore:"",append:[".ctool-page-option"],reduce:10},{default:a(({small:h,large:V})=>[e(l,{direction:"vertical"},{default:a(()=>[e(_,{modelValue:o(t).current.input,"onUpdate:modelValue":n[0]||(n[0]=u=>o(t).current.input=u),height:h,upload:"file"},null,8,["modelValue","height"]),e(x,{title:r.$t("main_ui_config"),class:"ctool-page-option"},{extra:a(()=>[e(l,null,{default:a(()=>[e(f,{link:"https://github.com/JuneAndGreen/sm-crypto"})]),_:1})]),default:a(()=>[e(l,{horizontal:"center"},{default:a(()=>[e(d,{modelValue:o(t).current.option.private_key,"onUpdate:modelValue":n[1]||(n[1]=u=>o(t).current.option.private_key=u),label:r.$t("sm2_private_key")},null,8,["modelValue","label"]),e(d,{modelValue:o(t).current.option.user_id,"onUpdate:modelValue":n[2]||(n[2]=u=>o(t).current.option.user_id=u),label:r.$t("sm2_userId")},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title"]),e(g,{modelValue:o(t).current.output,"onUpdate:modelValue":n[3]||(n[3]=u=>o(t).current.output=u),allow:["base64","hex"],content:c.value,height:V},null,8,["modelValue","content","height"])]),_:2},1024)]),_:1},8,["append"])}}});export{D as default};
