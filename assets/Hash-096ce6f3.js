var R=Object.defineProperty;var L=(s,t,r)=>t in s?R(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var v=(s,t,r)=>(L(s,typeof t!="symbol"?t+"":t,r),r);import{u as M,i as F}from"./action-b0774d39.js";import{T as z,d as N,y as P,z as V,A as q,k as B,v as p,w as c,r as m,B as J,f as x,j as l,c as k,m as O,F as G,q as K,C as Q}from"./tool-86fca7a1.js";import{C as $}from"./index-e2419851.js";import{s as W}from"./index-6f0f6895.js";import"./modulepreload-polyfill-3cfb730f.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./index-fe975519.js";import"./string_decoder-f7e7db28.js";import"./index-bbcdbdfc.js";const A=["md5","sha1","sha256","sha512","sm3"],C={md5:s=>$.MD5($.enc.Base64.parse(s.toBase64())).toString(),sha1:s=>$.SHA1($.enc.Base64.parse(s.toBase64())).toString(),sha256:s=>$.SHA256($.enc.Base64.parse(s.toBase64())).toString(),sha512:s=>$.SHA512($.enc.Base64.parse(s.toBase64())).toString(),sm3:s=>{const t=(o,h)=>o.length>=h?o:new Array(h-o.length+1).join("0")+o;let r=s.toHex({type:"hex"});const e=[];let n=r.length;n%2!==0&&(r=t(r,n+1)),n=r.length;for(let o=0;o<n;o+=2)e.push(parseInt(r.substr(o,2),16));return W.sm3(e)}};class T{constructor(t="root"){v(this,"parameter",[]);v(this,"flag","");if(!["hash","$input","$salt","root"].includes(t))throw new Error(`Expression Error (${t})`);this.flag=t}add(t){this.parameter.push(t)}toString(){if(this.flag==="root"){let t="";for(let r in this.parameter){const e=this.parameter[r].toString();t+=`${parseInt(r)>0?".":""}${e.toString()}`}return t}if(this.flag==="hash"){let t="";for(let r in this.parameter){const e=this.parameter[r].toString();t+=`${parseInt(r)>0?".":""}${e.toString()}`}return`hash(${t})`}return this.flag}getResult(t,r,e){if(this.flag==="$input")return t;if(this.flag==="$salt")return r;let n=[];for(let o in this.parameter)n.push(this.parameter[o].getResult(t,r,e));return this.flag==="root"?n.join(""):e(z.fromString(n.join("")))}}const X=(s="")=>{const t="__@@@__";s=s.replace(/\(/g,`${t}(${t}`).replace(/\)/g,`${t})${t}`).replace(/\./g,`${t}.${t}`);const r=s.split(t).filter(h=>h!=="");if(!["hash","$input","$salt"].includes(r[0]))throw new Error(`Expression Error ${r[0]}`);let e=new T,n=[e],o=null;for(let h of r){let E=n[n.length-1],_=null;switch(h){case".":break;case"hash":case"$input":case"$salt":_=new T(h),E.add(_),o=_;break;case"(":n.push(o);break;case")":if(n.length===1)throw new Error('Expression Error invalid ")"');n.pop();break;default:throw new Error(`Expression Error invalid "${h}"`)}}if(n.length>1)throw new Error('Expression Error invalid "("');return e},I=(s,t,r="",e="")=>{if(!Object.keys(C).includes(s))throw new Error(`hash method 不存在: ${s}`);const n=o=>C[s](o);return e===""?n(t):X(e).getResult(t.toString(),r,n)},ie=N({__name:"Hash",async setup(s){let t,r;const e=M(([t,r]=P(()=>F({input:Q(),salt:"",salt_exp:"",is_salt:!1,is_uppercase:!1,multiple:!1})),t=await t,r(),t)),n=V(()=>!e.current.is_salt||["upload","url"].includes(e.current.input.type)?"":e.current.salt_exp||""),o=V(()=>["text"].includes(e.current.input.type)),h=V(()=>{let u={md5:"",sha1:"",sha256:"",sha512:"",sm3:""};if(!e.current.input.text.isEmpty()){let a=!1;for(let f of A)try{if(e.current.input.text.isError())throw new Error(e.current.input.text.toString());const d=E(f,e.current.input.text,e.current.salt,n.value,o.value&&e.current.multiple);u[f]=e.current.is_uppercase?d.toUpperCase():d.toLowerCase()}catch(d){a=!0,u[f]=$error(d)}a||e.save()}return u}),E=(u,a,f,d,g)=>g?a.toString().split(`
`).map(S=>I(u,z.fromString(S,a.encoding()),f,d)).join(`
`):I(u,a,f,d),_=["hash(hash($input))","hash($input.$salt)","hash(hash($input).$salt)","hash($input).hash($salt)","hash(hash(hash($input)))","hash($salt.$input.$salt)","hash(hash($input.$salt).$salt)","hash($salt.hash($input.$salt).$salt)","hash($salt.hash($salt.$input.$salt).$salt)"];return(u,a)=>{const f=m("TextInput"),d=m("HeightResize"),g=m("Bool"),S=m("Tooltip"),b=m("Align"),D=m("Display"),y=m("Input"),H=m("Dropdown"),U=m("Textarea"),j=J("row");return q((x(),B("div",null,[p(b,{direction:"vertical"},{default:c(()=>[p(D,null,{extra:c(()=>[p(b,null,{default:c(()=>[p(g,{size:"small",modelValue:l(e).current.is_salt,"onUpdate:modelValue":a[1]||(a[1]=i=>l(e).current.is_salt=i),border:"",disabled:["upload","url"].includes(l(e).current.input.type),label:u.$t("hash_salt")},null,8,["modelValue","disabled","label"]),p(g,{size:"small",modelValue:l(e).current.is_uppercase,"onUpdate:modelValue":a[2]||(a[2]=i=>l(e).current.is_uppercase=i),border:"",label:u.$t("hash_uppercase")},null,8,["modelValue","label"]),p(S,{content:u.$t("hash_multiple_tooltip")},{default:c(()=>[p(g,{disabled:!l(o),size:"small",modelValue:l(e).current.multiple,"onUpdate:modelValue":a[3]||(a[3]=i=>l(e).current.multiple=i),border:"",label:u.$t("hash_multiple")},null,8,["disabled","modelValue","label"])]),_:1},8,["content"])]),_:1})]),default:c(()=>[p(d,{append:l(e).current.is_salt?[".ctool-hash-salt"]:[],reduce:l(e).current.is_salt?5:0},{default:c(({height:i})=>[p(f,{modelValue:l(e).current.input,"onUpdate:modelValue":a[0]||(a[0]=w=>l(e).current.input=w),height:i,upload:"file",encoding:""},null,8,["modelValue","height"])]),_:1},8,["append","reduce"])]),_:1}),l(e).current.is_salt?(x(),k(b,{key:0,direction:"vertical",class:"ctool-hash-salt"},{default:c(()=>[p(y,{modelValue:l(e).current.salt,"onUpdate:modelValue":a[4]||(a[4]=i=>l(e).current.salt=i),label:u.$t("hash_salt_value"),disabled:["upload","url"].includes(l(e).current.input.type)},null,8,["modelValue","label","disabled"]),p(y,{modelValue:l(e).current.salt_exp,"onUpdate:modelValue":a[6]||(a[6]=i=>l(e).current.salt_exp=i),label:u.$t("hash_salt_mode"),disabled:["upload","url"].includes(l(e).current.input.type)},{append:c(()=>[p(H,{disabled:["upload","url"].includes(l(e).current.input.type),onSelect:a[5]||(a[5]=i=>l(e).current.salt_exp=i),placeholder:u.$t("hash_salt_select"),options:_},null,8,["disabled","placeholder"])]),_:1},8,["modelValue","label","disabled"])]),_:1})):O("",!0)]),_:1}),p(d,null,{default:c(({height:i})=>[p(b,{direction:"vertical"},{default:c(()=>[(x(!0),B(G,null,K(l(A),w=>(x(),k(U,{"model-value":l(h)[w],height:(i-20)/5,placeholder:w,copy:w},null,8,["model-value","height","placeholder","copy"]))),256))]),_:2},1024)]),_:1})])),[[j,"10-14"]])}}});export{ie as default};
